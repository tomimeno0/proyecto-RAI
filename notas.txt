from flask import Flask, request, jsonify
import openai

app = Flask(__name__)

# âœ… Creamos cliente con la API Key
client = openai.OpenAI(api_key="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")

@app.route('/orden', methods=['POST'])
def procesar_orden():
    data = request.get_json()
    orden = data.get('command')  # ðŸ”§ Cambiado para que coincida con el cliente
    print(f"ðŸ“¥ Orden recibida: {orden}")

    try:
        response = client.chat.completions.create(
            model="gpt-4o",
            messages=[
                {"role": "system", "content": "Sos una IA Ãºtil y amable, respondÃ© con claridad."},
                {"role": "user", "content": orden}
            ],
            max_tokens=150,
            temperature=0.7,
        )
        respuesta_ia = response.choices[0].message.content.strip()

    except Exception as e:
        respuesta_ia = f"Error en IA: {e}"

    return jsonify({"response": respuesta_ia})

if __name__ == '__main__':
    app.run(host='127.0.0.1', port=5000, debug=True)
